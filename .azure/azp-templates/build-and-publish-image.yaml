parameters:
  contextDir: '<required>'
  dockerFile: '<required>'
  imageName: '<required>'
  imageVersion: '<required>'
  publishDockerHub: false
  publishACR: false

stages:
- stage: Build_and_Publish
  displayName: Build and Publish Docker image
  jobs:
  - template: '_job_build_docker_image.yaml'
    parameters:
      contextDir: '${{ parameters.contextDir }}'
      dockerFile: '${{ parameters.dockerFile }}'
      imageName: '${{ parameters.imageName }}'
      imageVersion: '${{ parameters.imageVersion }}'
  - job: List
    dependsOn: 'Build_Docker_image'
    displayName: List images
    steps:
    - script: docker images
  # - job: Build_and_Publish
  #   displayName: Build and Publish Docker image
  #   steps:
  #   - template: '_step_install_docker_cli.yaml'
  #   - ${{ if eq(parameters.publishDockerHub, True) }}:
  #     - task: Docker@2
  #       displayName: Login to Docker Hub
  #       inputs:
  #         command: login
  #         containerRegistry: dockerRegistryServiceConnectionDockerHub
  #   - template: '_step_build_docker_image.yaml'
  #     parameters:
  #       contextDir: '${{ parameters.contextDir }}'
  #       dockerFile: '${{ parameters.dockerFile }}'
  #       imageName: '${{ parameters.imageName }}'
  #       imageVersion: '${{ parameters.imageVersion }}'
  #   - task: Docker@2
  #     displayName: List images
  #     inputs:
  #       command: images
